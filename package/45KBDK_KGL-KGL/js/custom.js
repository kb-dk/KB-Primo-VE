!function o(a,s,c){function u(n,e){if(!s[n]){if(!a[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(l)return l(n,!0);var r=new Error("Cannot find module '"+n+"'");throw r.code="MODULE_NOT_FOUND",r}var i=s[n]={exports:{}};a[n][0].call(i.exports,function(e){return u(a[n][1][e]||e)},i,i.exports,o,a,s,c)}return s[n].exports}for(var l="function"==typeof require&&require,e=0;e<c.length;e++)u(c[e]);return u}({1:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.scriptIds={en:"b19d8ae41c784590fd84ba51114c29d2",da:"668df01b6f2cd836279a993a8fc944ec"}},{}],2:[function(e,n,t){"use strict";function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e,n,t){return n&&r(e.prototype,n),t&&r(e,t),e}(o,[{key:"$postLink",value:function(){angular.element(document.querySelector("md-card#personalDetails .md-toolbar-tools")).append(this.$element)}}]),o);function o(e){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,o),this.$element=e}i.$inject=["$element"];t.KbEditProfileConfig={name:"kbEditProfile",config:{controller:i,templateUrl:["viewName",function(e){return"custom/"+e+"/html/edit-profile/edit-profile.html"}]}}},{}],3:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PrmPersonalInfoAfterConfig={name:"prmPersonalInfoAfter",config:{bindings:{parentCtrl:"<"},template:"<kb-edit-profile></kb-edit-profile>"}}},{}],4:[function(e,n,t){"use strict";function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e,n,t){return n&&r(e.prototype,n),t&&r(e,t),e}(o,[{key:"changeLanguage",value:function(){var e="da"===this.lang?"en":"da";this.$location.search("lang",e),document.getElementsByTagName("html")[0].lang=e,this.$window.location.href=this.$location.absUrl()}}]),o);function o(e,n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,o),this.$window=e,this.$location=n,this.lang=this.parentCtrl.lang}i.$inject=["$window","$location"];t.KbLanguageConfig={name:"kbLanguage",config:{bindings:{parentCtrl:"<"},controller:i,templateUrl:["viewName",function(e){return"custom/"+e+"/html/language/language.html"}]}}},{}],5:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PrmUserAreaExpandableAfterConfig={name:"prmUserAreaExpandableAfter",config:{bindings:{parentCtrl:"<"},template:"<kb-language parent-ctrl='$ctrl.parentCtrl'></kb-language>"}}},{}],6:[function(e,n,t){"use strict";var r=e("./edit-profile/prmPersonalInfoAfter.component"),i=e("./edit-profile/kbEditProfile.component"),o=e("./navigation-header/prmTopBarBefore"),a=e("./navigation-header/kbNavigationHeader"),s=e("./language/prmUserAreaExpandableAfter.component"),c=e("./language/kbLanguage.component"),u=e("./chat-box/scriptIds.constant"),l=e("./open-items-location-filter/prmLocationItemsAfter.component"),m=e("./move-request-another-bin/prmServiceButtonAfter.component"),p=e("./pickup-numbers/pickUpNumbers.service"),f=e("./pickup-numbers/prmRequestsAfter.component");angular.module("viewCustom",["angularLoad"]).constant("viewName",function(){var e=window.location.search.substring(1),n=e.substring(e.indexOf("vid")+4);e||(n=(n=(e=window.location.pathname).substring(e.indexOf("/delivery/")+10)).substring(0,n.indexOf("/")));var t=(t=n.substring(0,n.indexOf("&"))?n.substring(0,n.indexOf("&")):n).replace("%3A","-");return console.log("vid:",t),t.replace(":","-")}()).constant("scriptIds",u.scriptIds).component(r.PrmPersonalInfoAfterConfig.name,r.PrmPersonalInfoAfterConfig.config).component(i.KbEditProfileConfig.name,i.KbEditProfileConfig.config).component(o.PrmTopBarBeforeConfig.name,o.PrmTopBarBeforeConfig.config).component(a.KbNavigationHeaderConfig.name,a.KbNavigationHeaderConfig.config).component(l.PrmLocationItemsAfterConfig.name,l.PrmLocationItemsAfterConfig.config).component(m.PrmServiceButtonAfterConfig.name,m.PrmServiceButtonAfterConfig.config).component(s.PrmUserAreaExpandableAfterConfig.name,s.PrmUserAreaExpandableAfterConfig.config).component(c.KbLanguageConfig.name,c.KbLanguageConfig.config).service("pickUpNumbersService",p.PickUpNumbersService).component(f.PrmRequestsAfterConfig.name,f.PrmRequestsAfterConfig.config),e("kb-primo-ve-announcement"),e("kb-primo-ve-hide-new-user-if-loggedin")},{"./chat-box/scriptIds.constant":1,"./edit-profile/kbEditProfile.component":2,"./edit-profile/prmPersonalInfoAfter.component":3,"./language/kbLanguage.component":4,"./language/prmUserAreaExpandableAfter.component":5,"./move-request-another-bin/prmServiceButtonAfter.component":7,"./navigation-header/kbNavigationHeader":8,"./navigation-header/prmTopBarBefore":9,"./open-items-location-filter/prmLocationItemsAfter.component":10,"./pickup-numbers/pickUpNumbers.service":11,"./pickup-numbers/prmRequestsAfter.component":12,"kb-primo-ve-announcement":13,"kb-primo-ve-hide-new-user-if-loggedin":14}],7:[function(e,n,t){"use strict";function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e,n,t){return n&&r(e.prototype,n),t&&r(e,t),e}(o,[{key:"$postLink",value:function(){var a=this;this.intervalId=this.$interval(function(){var e=angular.element(document.querySelector("span[translate='AlmaRequestOther']"));if(e.length&&(a.$interval.cancel(a.intervalId),(e=e.parent().parent())[0].textContent===angular.element(a.$element.parent())[0].textContent)){for(var n=e.parent();!n.hasClass("section-body")&&"BODY"!==n[0].tagName;)n=n.parent();n.append(e.parent()),e.parent().addClass("orderAtTheBottom"),e.parent().css("float","right");for(var t=angular.element(document.querySelectorAll("span[translate='AlmaItemRequest']")),r=0;r<t.length;r++)t[r].addEventListener("click",function(){document.getElementsByClassName("orderAtTheBottom")&&document.getElementsByClassName("orderAtTheBottom").length&&(console.log("hej"),e.css("display","none"))});for(var i=angular.element(document.querySelectorAll("prm-opac-back-button button")),o=0;o<i.length;o++)i[o].addEventListener("click",function(){document.getElementsByClassName("orderAtTheBottom")&&document.getElementsByClassName("orderAtTheBottom").length&&(document.getElementsByClassName("orderAtTheBottom")[0].remove(),e.css("display","inline-block"))})}},500,5)}}]),o);function o(e,n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,o),this.$element=e,this.$interval=n}i.$inject=["$element","$interval"];t.PrmServiceButtonAfterConfig={name:"prmServiceButtonAfter",config:{bindings:{parentCtrl:"<"},controller:i}}},{}],8:[function(e,n,t){"use strict";function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e,n,t){return n&&r(e.prototype,n),t&&r(e,t),e}(o,[{key:"$postLink",value:function(){var e=this.$element.parent().parent().parent().parent();angular.element(e.children()[0]).append(this.$element)}}]),o);function o(e){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,o),this.$element=e}i.$inject=["$element"];t.KbNavigationHeaderConfig={name:"kbNavigationHeader",config:{bindings:{parentCtrl:"<"},controller:i,templateUrl:["viewName",function(e){return"custom/"+e+"/html/navigation-header/navigation-header.html"}]}}},{}],9:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PrmTopBarBeforeConfig={name:"prmTopBarBefore",config:{bindings:{parentCtrl:"<"},template:"<kb-navigation-header parent-ctrl='$ctrl.parentCtrl'></kb-navigation-header>"}}},{}],10:[function(e,n,t){"use strict";function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e,n,t){return n&&r(e.prototype,n),t&&r(e,t),e}(o,[{key:"activateFilter",value:function(e){var n=angular.element(document.querySelectorAll("prm-locations > div > button.md-icon-button[aria-label='Filter']")),t=angular.element(document.querySelectorAll("prm-location-items  div  button.md-icon-button[aria-label='Filter']")),r=angular.element(document.querySelectorAll("prm-locations-filter md-input-container"));!n.length&&!t.length||r.length?r.length&&this.$interval.cancel(e):(this.$interval.cancel(e),n.length&&n.triggerHandler("click"),t.length&&t.triggerHandler("click"))}},{key:"$postLink",value:function(){var e=this;this.$intervalId=this.$interval(function(){e.activateFilter(e.$intervalId)},500,10)}}]),o);function o(e){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,o),this.$interval=e}i.$inject=["$interval"];t.PrmLocationItemsAfterConfig={name:"prmLocationItemsAfter",config:{bindings:{parentCtrl:"<"},controller:i}}},{}],11:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,n,t){return n&&i(e.prototype,n),t&&i(e,t),e};function i(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,o),this.$http=e,this.location=n,this._pickUpNumbersForIds={},this._runningPromise,this._ongoingInsertions=0}(t.PickUpNumbersService=(r(o,[{key:"waitForIdsAndInsertPickUpNumbers",value:function(t){var r=this;t.$scope.$watch(function(){return t.selector(t.parentElement).length},function(e,n){e&&e!==n&&r.retrieveAndInsertPickUpNumbers(t.parentCtrl,t.parentElement,t.parentCtrl.requestsService.requestsDisplay,t.selector)})}},{key:"retrieveAndInsertPickUpNumbers",value:function(e,n,t,r){var i=this;return this._runningPromise?this._runningPromise.then(function(){return i._insert(e,n,t,r)}):this._insert(e,n,t,r)}},{key:"getPickupLabel",value:function(){return"en"===this.location.search().lang?"Pickup number: ":"Ventehyldenummer: "}},{key:"getServiceBaseUrl",value:function(){var e=this.location.$$absUrl;return e.includes("kbdk-kgl-psb.primo.exlibrisgroup")?"https://public-stage.statsbiblioteket.dk/alma-pickupnumbers/services/public/pickupnumber/":e.includes("soeg.kb.dk")?"https://webservice.kb.dk/alma-pickupnumbers/services/public/pickupnumber/":"https://developer.statsbiblioteket.dk/alma-pickupnumbers/services/public/pickupnumber/"}},{key:"insertPickUpNumber",value:function(e,n){var t;-1===n.innerHTML.indexOf('<span class="pickupnumber">')&&(t="<br/><span class='pickupnumber'>"+this.getPickupLabel()+"</span>"+e+"<br/>",angular.element(n.querySelectorAll("p.request-location")).append(t))}},{key:"insertPickupnumbersToOverview",value:function(t){var r=this,i=document.querySelectorAll("prm-requests-overview");0<i.length?this.addPickupnumbersToOverview(i,t):ctrl.$scope.$watch(function(){return i.length},function(e,n){i.length&&r.addPickupnumbersToOverview(i,t)})}},{key:"addPickupnumbersToOverview",value:function(e,n){for(var t,r=angular.element(document.querySelectorAll('prm-requests-overview div[class="md-list-item-text layout-fill"]')),i=0;i<Object.keys(r).length-1;i++){this._pickUpNumbersForIds[n[i].requestId]&&-1===r[i].innerHTML.indexOf('<span class="pickupnumber">')&&(t='<p class="weak-text"><span class="pickupnumber">'+this.getPickupLabel()+"</span><span>"+this._pickUpNumbersForIds[n[i].requestId]+"</span></p>",angular.element(r[i]).append(t))}}},{key:"_insert",value:function(o,a,s,c){var u=this,l=this;return l._runningPromise=new Promise(function(t,e){var n=c(a),r=l._composeRequestObjects(n,s);l._ongoingInsertions=r.length;var i=[];r.forEach(function(e,n){i[n]=l._insertForRequest(o.requestsDisplay[n],e),i[n].then(function(){l._ongoingInsertions=l._ongoingInsertions-1,0===l._ongoingInsertions&&(u.insertPickupnumbersToOverview(s),t())}).catch(function(){l._ongoingInsertions=l._ongoingInsertions-1,0===l._ongoingInsertions&&(u.insertPickupnumbersToOverview(s),t())})})}),this._runningPromise}},{key:"_composeRequestObjects",value:function(t,e){return e.map(function(e,n){return{element:t[n],id:e.requestId,expandedDisplay:e.expandedDisplay,isAlert:e.isAlert}})}},{key:"_insertForRequest",value:function(e,r){var i=this,o=this;return new Promise(function(t,n){r.element?o._pickUpNumbersForIds[r.id]?(i.insertPickUpNumber(o._pickUpNumbersForIds[r.id],r.element),t()):r.isAlert?o._retrievePickUpNumber(r.id).then(function(e){var n=e.data.number;o._pickUpNumbersForIds[r.id]=n,i.insertPickUpNumber(n,r.element),t()}).catch(function(e){return console.log("Could not retrieve the pick up number."),n(e),e}):t():n()})}},{key:"_retrievePickUpNumber",value:function(e){return this.$http.get(this.getServiceBaseUrl()+e)}}]),o)).$inject=["$http","$location"]},{}],12:[function(e,n,t){"use strict";function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e,n,t){return n&&r(e.prototype,n),t&&r(e,t),e}(o,[{key:"$onInit",value:function(){this.parentElement=this.$element.parent()[0],this.pickUpNumbersService.waitForIdsAndInsertPickUpNumbers(this)}},{key:"selector",value:function(e){return e.querySelectorAll("md-list-item")}}]),o);function o(e,n,t){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,o),this.$scope=e,this.$element=n,this.pickUpNumbersService=t}i.$inject=["$scope","$element","pickUpNumbersService"];t.PrmRequestsAfterConfig={name:"prmRequestsAfter",config:{bindings:{parentCtrl:"<"},controller:i}}},{}],13:[function(m,e,n){!function o(a,s,c){function u(n,e){if(!s[n]){if(!a[n]){var t="function"==typeof m&&m;if(!e&&t)return t(n,!0);if(l)return l(n,!0);var r=new Error("Cannot find module '"+n+"'");throw r.code="MODULE_NOT_FOUND",r}var i=s[n]={exports:{}};a[n][0].call(i.exports,function(e){return u(a[n][1][e]||e)},i,i.exports,o,a,s,c)}return s[n].exports}for(var l="function"==typeof m&&m,e=0;e<c.length;e++)u(c[e]);return u}({1:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i,o;function a(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,n,t,r){var i=this;!function(e){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}(this),this.$translate=e,this.$mdToast=n,this.$rootScope=t,this.$cookies=r,this._dismissed=!1,this.$rootScope.$on("$translateChangeSuccess",function(){i._dismissed=!1})}(t.AnnouncementService=(r=s,(i=[{key:"_dismiss",value:function(){this._dismissed=!0,this._toastPromise=null}},{key:"display",value:function(r){var i=this;return new Promise(function(n,t){!0!==i._dismissed?i.$translate("nui.message.announcement").then(function(e){if(i.$cookies.get("announcement")!==e){if(!e||["announcement","&nbsp;",""].includes(e))return i._toastPromise&&!i._dismissed&&i.$mdToast.hide(),void t("No announcement found.");i._toastPromise=i._toastPromise||i.$mdToast.show({hideDelay:!1,position:"top",controller:function(){return{close:function(){i.$mdToast.hide(),i.$translate("nui.message.announcement").then(function(e){return i.$cookies.put("announcement",e)})}}},controllerAs:"$ctrl",template:'\n<md-toast class="page-notification" style="top: 0px; position: sticky !important;">\n    <div class="md-toast-content" style="box-shadow:none; width: 100%;">\n        <span class=\'md-toast-text\' flex translate=\'nui.message.announcement\'>\n  </span>\n    </div>\n    <a class="close" ng-click=\'$ctrl.close()\' aria-label="{{\'nui.message.dismiss\' | translate}}"\n       style="position: absolute; right: 1.5rem; top: 1.5rem;">\n        <prm-icon icon-type="svg" svg-icon-set="primo-ui" icon-definition="close">\n        </prm-icon>\n    </a>\n</md-toast>\n          '}),i._toastPromise.then(r).catch(r).then(function(){return i._dismiss()}),n()}else t("The announcement has been dismissed before.")}):t("The announcement has been dismissed.")})}}])&&a(r.prototype,i),o&&a(r,o),s)).$inject=["$translate","$mdToast","$rootScope","$cookies"]},{}],2:[function(e,n,t){"use strict";function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var i=(r(o.prototype,[{key:"$onInit",value:function(){this.announcementService.display().catch(function(e){e&&console.log(e)})}}]),o);function o(e,n,t,r){!function(e){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}(this),this.announcementService=e,this.$scope=n,this.$element=t,this.$translate=r}i.$inject=["announcementService","$scope","$element","$translate"],t.PrmTopbarAfterConfig={name:"prmTopbarAfter",config:{controller:i,require:{primoExploreCtrl:"^primoExplore"}}}},{}],3:[function(e,n,t){"use strict";var r=e("./announcement/announcement.service"),i=e("./announcement/prmTopbarAfter.component");angular.module("viewCustom").service("announcementService",r.AnnouncementService).component(i.PrmTopbarAfterConfig.name,i.PrmTopbarAfterConfig.config)},{"./announcement/announcement.service":1,"./announcement/prmTopbarAfter.component":2}]},{},[3])},{}],14:[function(m,e,n){!function o(a,s,c){function u(n,e){if(!s[n]){if(!a[n]){var t="function"==typeof m&&m;if(!e&&t)return t(n,!0);if(l)return l(n,!0);var r=new Error("Cannot find module '"+n+"'");throw r.code="MODULE_NOT_FOUND",r}var i=s[n]={exports:{}};a[n][0].call(i.exports,function(e){return u(a[n][1][e]||e)},i,i.exports,o,a,s,c)}return s[n].exports}for(var l="function"==typeof m&&m,e=0;e<c.length;e++)u(c[e]);return u}({1:[function(e,n,t){"use strict";function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var i=(r(o.prototype,[{key:"$postLink",value:function(){this.isLoggedIn&&angular.element(document).ready(function(){var e=angular.element(document.querySelector('div[data-main-menu-item="new_user"]'));e&&0!==e.length&&e.css("display","none")})}}]),o);function o(){!function(e){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}(this),this.isLoggedIn=this.parentCtrl.isLoggedIn}t.PrmTopNavBarLinksAfterConfig={name:"prmTopNavBarLinksAfter",config:{bindings:{parentCtrl:"<"},controller:i}}},{}],2:[function(e,n,t){"use strict";var r=e("./hide-new-user-if-loggedin/prmTopNavBarLinksAfter.component");angular.module("viewCustom").component(r.PrmTopNavBarLinksAfterConfig.name,r.PrmTopNavBarLinksAfterConfig.config)},{"./hide-new-user-if-loggedin/prmTopNavBarLinksAfter.component":1}]},{},[2])},{}]},{},[6]);
//# sourceMappingURL=custom.js.map
